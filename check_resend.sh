#!/bin/bash

echo ""
echo "ğŸ” DiagnÃ³stico Completo do Problema de Email"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# 1. Verificar username do Resend no Supabase
echo "ğŸ“‹ DIAGNÃ“STICO #1: Username do SMTP"
echo "   No screenshot vocÃª mostrou: 'localcashback'"
echo "   âš ï¸  PROBLEMA: O username do Resend deve ser 'resend'"
echo "   âŒ Username 'localcashback' estÃ¡ INCORRETO"
echo ""
echo "   âœ… CORREÃ‡ÃƒO:"
echo "      Username: resend"
echo "      Password: <sua API Key do Resend (comeÃ§a com re_)>"
echo ""

# 2. Verificar se a API key do Resend Ã© vÃ¡lida
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“‹ DIAGNÃ“STICO #2: API Key do Resend"
echo ""
echo "   A API key do Resend deve:"
echo "   âœ… ComeÃ§ar com 're_'"
echo "   âœ… Ter permissÃµes de 'Sending Access'"
echo "   âœ… Estar ativa (nÃ£o revogada)"
echo ""

# 3. Verificar domÃ­nio verificado
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“‹ DIAGNÃ“STICO #3: DomÃ­nio Verificado no Resend"
echo ""
echo "   âš ï¸  IMPORTANTE: O Resend precisa de um domÃ­nio verificado"
echo ""
echo "   OpÃ§Ãµes:"
echo "   A) Usar domÃ­nio onboarding (teste - 100 emails/dia):"
echo "      From: onboarding@resend.dev"
echo ""
echo "   B) Adicionar seu domÃ­nio:"
echo "      1. Ir em Resend Dashboard > Domains"
echo "      2. Adicionar seu domÃ­nio (ex: localcashback.com)"
echo "      3. Adicionar registros DNS (SPF, DKIM, DMARC)"
echo "      4. Aguardar verificaÃ§Ã£o"
echo ""

# 4. Mostrar configuraÃ§Ã£o correta
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… CONFIGURAÃ‡ÃƒO CORRETA NO SUPABASE:"
echo ""
echo "   Host: smtp.resend.com"
echo "   Port: 587"
echo "   Username: resend"
echo "   Password: re_xxxxxxxxxxxxxxxxxxxxx"
echo "   Sender Name: LocalCashback"
echo "   Sender Email: onboarding@resend.dev"
echo ""
echo "   (Ou use seu domÃ­nio verificado no Sender Email)"
echo ""

# 5. Verificar outra possibilidade: Email template
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“‹ DIAGNÃ“STICO #4: Email Templates do Supabase"
echo ""
echo "   Verifique se os templates de email estÃ£o configurados:"
echo "   Supabase Dashboard > Authentication > Email Templates"
echo ""
echo "   Template necessÃ¡rio:"
echo "   - Reset Password (Magic Link)"
echo ""

# 6. Alternativa: Usar SendGrid
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ’¡ ALTERNATIVA: Usar SendGrid (mais simples)"
echo ""
echo "   SendGrid Ã© mais fÃ¡cil de configurar:"
echo ""
echo "   1. Criar conta: https://signup.sendgrid.com/"
echo "   2. Criar API Key (Settings > API Keys)"
echo "   3. Configurar no Supabase:"
echo "      Host: smtp.sendgrid.net"
echo "      Port: 587"
echo "      Username: apikey"
echo "      Password: SG.xxxxxxxxxxxxxxxxxxxxx"
echo "      Sender: seu-email@gmail.com (verificado)"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ¯ AÃ‡ÃƒO IMEDIATA RECOMENDADA:"
echo ""
echo "   OPÃ‡ÃƒO 1 - Corrigir Resend (se quiser continuar):"
echo "   1. Voltar no Supabase > Authentication > SMTP"
echo "   2. Trocar Username de 'localcashback' para 'resend'"
echo "   3. Verificar se a senha Ã© sua API Key vÃ¡lida"
echo "   4. Trocar Sender Email para 'onboarding@resend.dev'"
echo "   5. Salvar e aguardar 2 minutos"
echo "   6. Testar novamente"
echo ""
echo "   OPÃ‡ÃƒO 2 - Usar SendGrid (mais rÃ¡pido):"
echo "   1. Criar conta SendGrid"
echo "   2. Criar API Key"
echo "   3. Configurar no Supabase conforme acima"
echo "   4. Testar"
echo ""
